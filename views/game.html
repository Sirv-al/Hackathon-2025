<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Adventure</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* Prevents scrollbars */

            color: #000000;
        }

        /* This is the main container. It will hold the 3D map as the background.
          We use 'position: relative' so we can 'absolutely' position
          all the UI widgets on top of it.
        */
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            pointer-events: none; /* Allow clicks to pass through to map */
        }

        #game-container > * {
            pointer-events: auto; /* Re-enable clicks for game container children */
        }

        #map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        /* This is the "bare bones box" style for all UI widgets.
          They have a white background, black border, and are positioned absolutely.
        */
        .widget {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.2);
            margin: 10px;
            padding: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            pointer-events: auto; /* Ensure widgets are clickable */
        }

        /* --- Widget Positioning --- */

        #top-right-widget {
            top: 0;
            right: 0;
            width: 300px;
        }

        #stats-panel {
            bottom: 0;
            left: 0;
            width: 250px;
        }

        #log-widget {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%); /* Center the widget */
            width: 50%;
            max-width: 700px;
        }

        /* --- Widget Content Styling --- */

        #avatar-container {
            position: relative;
            height: 200px; /* Fixed height instead of min-height */
            border-bottom: 1px solid black;
            background-color: rgba(255, 255, 255, 0.9); /* More opaque background */
            overflow: hidden;
            width: 100%;
        }
        
        /* Remove any paragraph margins in the avatar container */
        #avatar-container p {
            display: none;
        }
        #avatar-response {
            min-height: 50px;
            border-bottom: 1px solid black;
        }
        #map-selector-container {
            border-bottom: 1px solid black;
        }

        /* Game Log Styling */
        #game-log {
            height: 200px; /* Give the log a fixed height */
            overflow-y: auto; /* Make it scrollable */
            border-bottom: 1px solid black;
            padding: 5px;
            background-color: rgba(255, 0, 0, 0.05);
        }

        /* Hide the game log by default (as per new request) */
        #game-log.hidden {
            display: none;
        }

        /* Player Input Form */
        #player-input-form {
            display: flex;
        }
        #player-text-input {
            flex-grow: 1;
        }

        /* Dice Container (Hidden by default) */
        #dice-container {
            display: none; /* game.js will change this to 'display: block;' */
            padding: 10px;
        }

    </style>
</head>
<body>

    <!--
      This is now the background. Your 'map.js' script will target this div.
      All other UI elements are "on top" of this.
    -->
    <main id="game-container">
        <!-- Map container -->
        <div id="map-container">
            <!-- Three.js Map will load here -->
        </div>

        <!--
          This is a "widget container" for everything in the top right.
        -->
    <div id="top-right-widget" class="widget">

        <!-- Avatar -->
        <div id="avatar-container">
            <p>Three.js Avatar will load here.</p>
        
        
        </div>

        <!-- Avatar Response -->
        <div id="avatar-response">
            <p><strong>Game Master:</strong>Please wait...</p>
        </div>

        <!-- Map Selector -->
        <div id="map-selector-container">
            <label for="map-select">Choose a map:</label>
            <select name="maps" id="map-select">
                <option value="forest">Dark Forest</option>
                <option value="cave">Goblin Cave</option>
                <option value="town">Village Square</option>
            </select>
            <button id="map-submit-button">Load Map</button>
        </div>

        <!-- Dice -->
        <div id="dice-container">
            <button id="roll-d20-button">Roll d20</button>
        </div>

    </div>


    <!-- Stats Panel Widget (Bottom Left) -->
    <div id="stats-panel" class="widget">
        <h2 id="player-username">Loading...</h2>
        <div>
            <strong>HP:</strong>
            <span id="player-hp">20</span> / <span id="player-max-hp">20</span>
        </div>
        <div>
            <strong>Strength:</strong>
            <span id="player-str">10</span>
        </div>
        <div>
            <strong>Dexterity:</strong>
            <span id="player-dex">10</span>
        </div>
        <div>
            <strong>Intelligence:</strong>
            <span id="player-int">10</span>
        </div>
    </div>

    <!-- Log and Input Widget (Bottom Middle) -->
    <div id="log-widget" class="widget">
        <!-- Game Log -->
        <div id="game-log">
            <p>Game narrative and history will appear here...</p>
        </div>

        <!-- Player Speech -->
        <div id="speech-bubble">
            <p><strong>You:</strong> "I look around."</p>
        </div>

        <!-- Player Input -->
        <div id="player-input-form-container">
            <form id="player-input-form">
                <input
                    type="text"
                    id="player-text-input"
                    placeholder="What do you do?"
                    autocomplete="off"
                    required>
                <button type="submit">Send</button>
            </form>
        </div>
    </div>


    <!--
      JavaScript Files
      - game.js: Your main logic.
      - avatar.js / map.js: Modules for your teammate.
    -->
    <script type="module">
        import { initAvatarScene } from './avatarScene.js';
        
        // Initialize the avatar scene in the container
        document.addEventListener('DOMContentLoaded', () => {
            const cleanup = initAvatarScene('avatar-container');
            
            // Clean up when needed (page unload)
            window.addEventListener('unload', cleanup);
        });
    </script>
    <script type="module">
        import { initMapScene } from './mapScene.js';
        
        // Initialize the map scene in the container
        document.addEventListener('DOMContentLoaded', () => {
            const cleanup = initMapScene('map-container');
            
            // Clean up when needed (page unload)
            window.addEventListener('unload', cleanup);
        });
    </script>

        <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
        }
    }
    </script>

    <!-- Import your avatar scene module -->
    <script type="module" src="avatarScene.js"></script>
    
    <script src="game.js"></script>

</body>
</html>